# VERSION: 9fd4c63
# THIS FILE IS AUTOGENERATED - DO NOT EDIT
# Source: https://github.com/Software-Automation-Holdings-LLC/developer-common/blob/aea5710fd6c60d44f7b95d36cc01b7798d865d51/github-workflow-templates/cleanup-resolved-alerts.yml

name: Cleanup Resolved Alerts

# Closes Linear tickets and PRs when their linked GitHub security alerts are fixed.
# Runs on: schedule (daily), after CodeQL completes, and manual dispatch.

on:
  # Daily cleanup
  schedule:
    - cron: "0 6 * * *" # 6 AM UTC daily

  # Run after CodeQL completes (alerts are updated after scan)
  workflow_run:
    workflows: ["CodeQL"]
    types:
      - completed
    branches:
      - main
      - master

  # Manual trigger
  workflow_dispatch:
    inputs:
      dry_run:
        description: "Dry run - check without making changes"
        required: false
        type: boolean
        default: false

# Restrict default permissions - expanded at job level
permissions: {}

# Only allow one cleanup run at a time per repo to avoid rate limits
concurrency:
  group: cleanup-resolved-alerts-${{ github.repository }}
  cancel-in-progress: true

jobs:
  cleanup:
    # Only run if CodeQL succeeded (or if triggered by schedule/manual)
    if: github.event_name != 'workflow_run' || github.event.workflow_run.conclusion == 'success'
    permissions:
      contents: read
      pull-requests: write
      security-events: read
    uses: Software-Automation-Holdings-LLC/developer-common/.github/workflows/cleanup-resolved-alerts.yml@aea5710fd6c60d44f7b95d36cc01b7798d865d51
    with:
      dry_run: ${{ inputs.dry_run || false }}
    secrets:
      LINEAR_API_KEY: ${{ secrets.LINEAR_API_KEY }}
      DEV_BOT_APP_ID: ${{ secrets.DEV_BOT_APP_ID }}
      DEV_BOT_PRIVATE_KEY: ${{ secrets.DEV_BOT_PRIVATE_KEY }}
