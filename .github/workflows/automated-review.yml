# VERSION: 1060543
# THIS FILE IS AUTOGENERATED - DO NOT EDIT
# Source: https://github.com/Software-Automation-Holdings-LLC/developer-common/blob/aea5710fd6c60d44f7b95d36cc01b7798d865d51/github-workflow-templates/automated-review.yml

# NOTE: This workflow requires Claude Code OAuth token to function.
# Prerequisites:
# - CLAUDE_CODE_OAUTH_TOKEN org secret (from https://claude.ai)
# - DEV_BOT_APP_ID and DEV_BOT_PRIVATE_KEY org secrets
#
# Triggers:
# - PR labeled with 'ready-for-automated-review'
# - PR assigned to 'sah-dev-bot'
#
# If 'autofix' label is present, bot will attempt to fix all issues automatically.
# The workflow performs senior engineer-level code review using Claude Code,
# applies fixes automatically, and iterates up to 3 times.

name: Automated Review

on:
  pull_request:
    types: [labeled, synchronize, assigned]

# Restrict default permissions - expanded at job level
permissions: {}

jobs:
  trigger-review:
    # Run when:
    # 1. PR has 'ready-for-automated-review' label, OR
    # 2. PR is assigned to 'sah-dev-bot'
    if: |
      contains(github.event.pull_request.labels.*.name, 'ready-for-automated-review') ||
      (github.event.action == 'assigned' && github.event.assignee.login == 'sah-dev-bot')
    permissions:
      pull-requests: write
      issues: write
      contents: write
    uses: Software-Automation-Holdings-LLC/developer-common/.github/workflows/automated-review.yml@aea5710fd6c60d44f7b95d36cc01b7798d865d51
    with:
      trigger_type: ${{ github.event.action == 'assigned' && 'assignment' || 'label' }}
      autofix_mode: ${{ contains(github.event.pull_request.labels.*.name, 'autofix') }}
    secrets:
      CLAUDE_CODE_OAUTH_TOKEN: ${{ secrets.CLAUDE_CODE_OAUTH_TOKEN }}
      DEV_BOT_APP_ID: ${{ secrets.DEV_BOT_APP_ID }}
      DEV_BOT_PRIVATE_KEY: ${{ secrets.DEV_BOT_PRIVATE_KEY }}
