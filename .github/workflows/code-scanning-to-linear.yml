# VERSION: e6f50a9
# THIS FILE IS AUTOGENERATED - DO NOT EDIT
# Source: https://github.com/Software-Automation-Holdings-LLC/developer-common/blob/968d7b9ece8ab9b8aa66832b63567e3ca34c458a/github-workflow-templates/code-scanning-to-linear.yml

name: Code Scanning to Linear

on:
  # Run after CodeQL completes (new alerts appear after scans)
  workflow_run:
    workflows: ["CodeQL", "CodeQL Security Scanning"]
    types:
      - completed
    branches:
      - main
      - master

  # Allow manual trigger for single alert or all
  workflow_dispatch:
    inputs:
      alert_number:
        description: "Alert number to process (leave empty for all open alerts)"
        required: false
        type: string
      dry_run:
        description: "Dry run - check without creating tickets"
        required: false
        type: boolean
        default: false

# Restrict default permissions - expanded at job level
permissions: {}

# Only allow one ticket creation run at a time per repo
concurrency:
  group: code-scanning-linear-${{ github.repository }}
  cancel-in-progress: false # Don't cancel - queue instead

jobs:
  create-tickets:
    # Only run if CodeQL succeeded (or if triggered manually)
    if: github.event_name != 'workflow_run' || github.event.workflow_run.conclusion == 'success'
    permissions:
      contents: read
      security-events: read
    uses: Software-Automation-Holdings-LLC/developer-common/.github/workflows/code-scanning-to-linear.yml@968d7b9ece8ab9b8aa66832b63567e3ca34c458a
    with:
      alert_number: ${{ inputs.alert_number || '0' }}
      dry_run: ${{ inputs.dry_run || false }}
    secrets:
      LINEAR_API_KEY: ${{ secrets.LINEAR_API_KEY }}
      DEV_BOT_APP_ID: ${{ secrets.DEV_BOT_APP_ID }}
      DEV_BOT_PRIVATE_KEY: ${{ secrets.DEV_BOT_PRIVATE_KEY }}
